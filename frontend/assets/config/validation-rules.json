{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "version": "2.2.0",
  "description": "Centralized validation rules for TrossApp - shared across frontend and backend",
  "lastUpdated": "2025-12-30",
  "policy": {
    "email": {
      "tldValidation": "permissive",
      "description": "Accept any TLD format - no fascist restrictions! ðŸš€"
    }
  },
  "fields": {
    "email": {
      "type": "string",
      "format": "email",
      "required": true,
      "maxLength": 255,
      "tldRestriction": false,
      "trim": true,
      "lowercase": true,
      "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z0-9]+$",
      "errorMessages": {
        "required": "Email is required",
        "format": "Email must be a valid email address",
        "maxLength": "Email cannot exceed 255 characters"
      },
      "examples": {
        "valid": [
          "user@example.com",
          "laura@jane.grace",
          "admin@my.cool.site",
          "test+tag@domain.xyz"
        ],
        "invalid": [
          "notanemail",
          "@domain.com",
          "user@",
          "user @domain.com"
        ]
      }
    },
    "customer_profile_id": {
      "type": "integer",
      "required": false,
      "min": 1,
      "max": 2147483647,
      "errorMessages": {
        "type": "Customer profile ID must be a number",
        "min": "Customer profile ID must be positive",
        "max": "Customer profile ID exceeds maximum value"
      },
      "examples": {
        "valid": [
          1,
          5,
          100
        ],
        "invalid": [
          0,
          -1,
          "abc"
        ]
      }
    },
    "technician_profile_id": {
      "type": "integer",
      "required": false,
      "min": 1,
      "max": 2147483647,
      "errorMessages": {
        "type": "Technician profile ID must be a number",
        "min": "Technician profile ID must be positive",
        "max": "Technician profile ID exceeds maximum value"
      },
      "examples": {
        "valid": [
          1,
          5,
          100
        ],
        "invalid": [
          0,
          -1,
          "abc"
        ]
      }
    },
    "role_name": {
      "type": "string",
      "required": true,
      "minLength": 2,
      "maxLength": 100,
      "trim": true,
      "pattern": "^[a-zA-Z0-9\\s_-]+$",
      "errorMessages": {
        "required": "Role name is required",
        "minLength": "Role name must be at least 2 characters",
        "maxLength": "Role name cannot exceed 100 characters",
        "pattern": "Role name can only contain letters, numbers, spaces, underscores, and hyphens"
      },
      "examples": {
        "valid": [
          "admin",
          "project_manager",
          "client",
          "super-admin"
        ],
        "invalid": [
          "a",
          "role!",
          "",
          "   "
        ]
      }
    },
    "role_priority": {
      "type": "integer",
      "required": false,
      "min": 1,
      "max": 100,
      "default": 50,
      "errorMessages": {
        "type": "Priority must be a number",
        "min": "Priority must be at least 1",
        "max": "Priority cannot exceed 100"
      },
      "examples": {
        "valid": [
          10,
          50,
          100
        ],
        "invalid": [
          0,
          -1,
          101,
          "high"
        ]
      }
    },
    "role_description": {
      "type": "string",
      "required": false,
      "maxLength": 500,
      "trim": true,
      "allowNull": true,
      "errorMessages": {
        "maxLength": "Description cannot exceed 500 characters"
      },
      "examples": {
        "valid": [
          "System administrator with full access",
          "Client with limited project access",
          null
        ],
        "invalid": [
          ""
        ]
      }
    },
    "phone": {
      "type": "string",
      "required": false,
      "pattern": "^\\+?[1-9]\\d{1,14}$",
      "trim": true,
      "errorMessages": {
        "pattern": "Phone number must be in international format (E.164)"
      },
      "examples": {
        "valid": [
          "+14155552671",
          "+442071838750",
          "14155552671"
        ],
        "invalid": [
          "123",
          "not-a-phone",
          "+1234567890123456"
        ]
      }
    },
    "url": {
      "type": "string",
      "required": false,
      "maxLength": 2048,
      "pattern": "^https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)$",
      "errorMessages": {
        "pattern": "Must be a valid URL starting with http:// or https://",
        "maxLength": "URL cannot exceed 2048 characters"
      },
      "examples": {
        "valid": [
          "https://example.com",
          "http://my-site.co.uk/path?query=value"
        ],
        "invalid": [
          "not-a-url",
          "ftp://example.com",
          "example.com"
        ]
      }
    },
    "sku": {
      "type": "string",
      "required": true,
      "minLength": 1,
      "maxLength": 100,
      "trim": true,
      "errorMessages": {
        "required": "SKU is required",
        "minLength": "SKU cannot be empty",
        "maxLength": "SKU cannot exceed 100 characters"
      }
    },
    "quantity": {
      "type": "integer",
      "required": true,
      "min": 0,
      "errorMessages": {
        "required": "Quantity is required",
        "type": "Quantity must be an integer",
        "min": "Quantity cannot be negative"
      }
    },
    "amount": {
      "type": "number",
      "required": true,
      "min": 0,
      "errorMessages": {
        "required": "Amount is required",
        "type": "Amount must be a number",
        "min": "Amount cannot be negative"
      }
    },
    "name": {
      "type": "string",
      "required": true,
      "minLength": 1,
      "maxLength": 255,
      "trim": true,
      "errorMessages": {
        "required": "Name is required",
        "minLength": "Name cannot be empty",
        "maxLength": "Name cannot exceed 255 characters"
      }
    },
    "summary": {
      "type": "string",
      "required": false,
      "maxLength": 255,
      "trim": true,
      "errorMessages": {
        "maxLength": "Summary cannot exceed 255 characters"
      }
    },
    "description": {
      "type": "string",
      "required": false,
      "maxLength": 5000,
      "trim": true,
      "errorMessages": {
        "maxLength": "Description cannot exceed 5000 characters"
      }
    },
    "technician_id": {
      "type": "integer",
      "required": false,
      "min": 1,
      "errorMessages": {
        "type": "Technician ID must be an integer",
        "min": "Technician ID must be positive"
      }
    },
    "status": {
      "type": "string",
      "required": false,
      "maxLength": 50,
      "trim": true,
      "errorMessages": {
        "maxLength": "Status cannot exceed 50 characters"
      }
    },
    "role_status": {
      "type": "string",
      "required": false,
      "enum": [
        "active",
        "disabled"
      ],
      "errorMessages": {
        "enum": "Role status must be one of: active, disabled"
      }
    },
    "user_status": {
      "type": "string",
      "required": false,
      "enum": [
        "pending_activation",
        "active",
        "suspended"
      ],
      "errorMessages": {
        "enum": "User status must be one of: pending_activation, active, suspended"
      }
    },
    "customer_status": {
      "type": "string",
      "required": false,
      "enum": [
        "pending",
        "active",
        "suspended"
      ],
      "errorMessages": {
        "enum": "Customer status must be one of: pending, active, suspended"
      }
    },
    "technician_status": {
      "type": "string",
      "required": false,
      "enum": [
        "available",
        "on_job",
        "off_duty",
        "suspended"
      ],
      "errorMessages": {
        "enum": "Technician status must be one of: available, on_job, off_duty, suspended"
      }
    },
    "work_order_status": {
      "type": "string",
      "required": false,
      "enum": [
        "pending",
        "assigned",
        "in_progress",
        "completed",
        "cancelled"
      ],
      "errorMessages": {
        "enum": "Work order status must be one of: pending, assigned, in_progress, completed, cancelled"
      }
    },
    "invoice_status": {
      "type": "string",
      "required": false,
      "enum": [
        "draft",
        "sent",
        "paid",
        "overdue",
        "cancelled"
      ],
      "errorMessages": {
        "enum": "Invoice status must be one of: draft, sent, paid, overdue, cancelled"
      }
    },
    "contract_status": {
      "type": "string",
      "required": false,
      "enum": [
        "draft",
        "active",
        "expired",
        "cancelled"
      ],
      "errorMessages": {
        "enum": "Contract status must be one of: draft, active, expired, cancelled"
      }
    },
    "inventory_status": {
      "type": "string",
      "required": false,
      "enum": [
        "in_stock",
        "low_stock",
        "out_of_stock",
        "discontinued"
      ],
      "errorMessages": {
        "enum": "Inventory status must be one of: in_stock, low_stock, out_of_stock, discontinued"
      }
    },
    "priority": {
      "type": "string",
      "required": false,
      "enum": [
        "low",
        "normal",
        "high",
        "urgent"
      ],
      "errorMessages": {
        "enum": "Priority must be one of: low, normal, high, urgent"
      }
    },
    "company_name": {
      "type": "string",
      "required": false,
      "maxLength": 255,
      "trim": true,
      "errorMessages": {
        "maxLength": "Company name cannot exceed 255 characters"
      }
    },
    "due_date": {
      "type": "date",
      "format": "date",
      "required": false,
      "errorMessages": {
        "format": "Due date must be a valid date in ISO format (YYYY-MM-DD)"
      }
    },
    "first_name": {
      "type": "string",
      "required": true,
      "minLength": 1,
      "maxLength": 100,
      "trim": true,
      "errorMessages": {
        "required": "First name is required",
        "minLength": "First name cannot be empty",
        "maxLength": "First name cannot exceed 100 characters"
      }
    },
    "last_name": {
      "type": "string",
      "required": true,
      "minLength": 1,
      "maxLength": 100,
      "trim": true,
      "errorMessages": {
        "required": "Last name is required",
        "minLength": "Last name cannot be empty",
        "maxLength": "Last name cannot exceed 100 characters"
      }
    },
    "role_id": {
      "type": "integer",
      "required": false,
      "min": 1,
      "max": 2147483647,
      "errorMessages": {
        "type": "Role ID must be a number",
        "min": "Role ID must be positive",
        "max": "Role ID exceeds maximum value"
      }
    },
    "is_active": {
      "type": "boolean",
      "required": false,
      "errorMessages": {
        "type": "is_active must be true or false"
      }
    },
    "license_number": {
      "type": "string",
      "required": false,
      "minLength": 3,
      "maxLength": 100,
      "trim": true,
      "errorMessages": {
        "minLength": "License number must be at least 3 characters",
        "maxLength": "License number cannot exceed 100 characters"
      }
    },
    "hourly_rate": {
      "type": "number",
      "required": false,
      "min": 0,
      "max": 9999.99,
      "errorMessages": {
        "type": "Hourly rate must be a number",
        "min": "Hourly rate cannot be negative",
        "max": "Hourly rate cannot exceed 9999.99"
      }
    },
    "customer_id": {
      "type": "integer",
      "required": true,
      "min": 1,
      "errorMessages": {
        "required": "Customer ID is required",
        "type": "Customer ID must be an integer",
        "min": "Customer ID must be positive"
      }
    },
    "assigned_technician_id": {
      "type": "integer",
      "required": false,
      "min": 1,
      "errorMessages": {
        "type": "Assigned technician ID must be an integer",
        "min": "Assigned technician ID must be positive"
      }
    },
    "work_order_id": {
      "type": "integer",
      "required": false,
      "min": 1,
      "errorMessages": {
        "type": "Work order ID must be an integer",
        "min": "Work order ID must be positive"
      }
    },
    "invoice_number": {
      "type": "string",
      "required": true,
      "minLength": 1,
      "maxLength": 100,
      "trim": true,
      "pattern": "^INV-[0-9]{4}-[0-9]+$",
      "errorMessages": {
        "required": "Invoice number is required",
        "minLength": "Invoice number cannot be empty",
        "maxLength": "Invoice number cannot exceed 100 characters",
        "pattern": "Invoice number must be in format INV-YYYY-NNNN"
      },
      "examples": {
        "valid": ["INV-2025-0001", "INV-2024-1234"],
        "invalid": ["INV-25-001", "INVOICE-2025-0001", "2025-0001"]
      }
    },
    "contract_number": {
      "type": "string",
      "required": true,
      "minLength": 1,
      "maxLength": 100,
      "trim": true,
      "pattern": "^CTR-[0-9]{4}-[0-9]+$",
      "errorMessages": {
        "required": "Contract number is required",
        "minLength": "Contract number cannot be empty",
        "maxLength": "Contract number cannot exceed 100 characters",
        "pattern": "Contract number must be in format CTR-YYYY-NNNN"
      },
      "examples": {
        "valid": ["CTR-2025-0001", "CTR-2024-1234"],
        "invalid": ["CTR-25-001", "CONTRACT-2025-0001", "2025-0001"]
      }
    },
    "work_order_number": {
      "type": "string",
      "required": true,
      "minLength": 1,
      "maxLength": 100,
      "trim": true,
      "pattern": "^WO-[0-9]{4}-[0-9]+$",
      "errorMessages": {
        "required": "Work order number is required",
        "minLength": "Work order number cannot be empty",
        "maxLength": "Work order number cannot exceed 100 characters",
        "pattern": "Work order number must be in format WO-YYYY-NNNN"
      },
      "examples": {
        "valid": ["WO-2025-0001", "WO-2024-1234"],
        "invalid": ["WO-25-001", "WORKORDER-2025-0001", "2025-0001"]
      }
    },
    "organization_name": {
      "type": "string",
      "required": false,
      "maxLength": 255,
      "trim": true,
      "errorMessages": {
        "maxLength": "Organization name cannot exceed 255 characters"
      }
    },
    "start_date": {
      "type": "string",
      "required": false,
      "format": "date",
      "errorMessages": {
        "format": "Start date must be in YYYY-MM-DD format"
      }
    },
    "end_date": {
      "type": "string",
      "required": false,
      "format": "date",
      "errorMessages": {
        "format": "End date must be in YYYY-MM-DD format"
      }
    },
    "value": {
      "type": "number",
      "required": false,
      "min": 0,
      "errorMessages": {
        "type": "Value must be a number",
        "min": "Value cannot be negative"
      }
    },
    "total": {
      "type": "number",
      "required": true,
      "min": 0,
      "errorMessages": {
        "required": "Total is required",
        "type": "Total must be a number",
        "min": "Total cannot be negative"
      }
    },
    "tax": {
      "type": "number",
      "required": false,
      "min": 0,
      "errorMessages": {
        "type": "Tax must be a number",
        "min": "Tax cannot be negative"
      }
    },
    "entity_type": {
      "type": "string",
      "required": true,
      "maxLength": 50,
      "pattern": "^[a-z_]+$",
      "errorMessages": {
        "required": "Entity type is required",
        "maxLength": "Entity type cannot exceed 50 characters",
        "pattern": "Entity type must be lowercase with underscores only"
      },
      "examples": {
        "valid": ["customer", "work_order", "invoice", "technician"],
        "invalid": ["Customer", "work-order", "123", ""]
      }
    },
    "original_filename": {
      "type": "string",
      "required": true,
      "maxLength": 255,
      "trim": true,
      "errorMessages": {
        "required": "Filename is required",
        "maxLength": "Filename cannot exceed 255 characters"
      },
      "examples": {
        "valid": ["document.pdf", "photo_2025.jpg", "report.csv"],
        "invalid": ["", null]
      }
    },
    "storage_key": {
      "type": "string",
      "required": true,
      "maxLength": 500,
      "errorMessages": {
        "required": "Storage key is required",
        "maxLength": "Storage key cannot exceed 500 characters"
      }
    },
    "mime_type": {
      "type": "string",
      "required": true,
      "maxLength": 100,
      "pattern": "^[a-z]+/[a-z0-9.+-]+$",
      "errorMessages": {
        "required": "MIME type is required",
        "maxLength": "MIME type cannot exceed 100 characters",
        "pattern": "Invalid MIME type format"
      },
      "examples": {
        "valid": ["image/jpeg", "application/pdf", "text/plain"],
        "invalid": ["jpeg", "image", "JPEG", ""]
      },
      "allowedValues": [
        "image/jpeg",
        "image/png",
        "image/gif",
        "image/webp",
        "application/pdf",
        "text/plain",
        "text/csv"
      ]
    },
    "file_size": {
      "type": "integer",
      "required": true,
      "min": 1,
      "max": 10485760,
      "errorMessages": {
        "required": "File size is required",
        "type": "File size must be a number",
        "min": "File size must be positive",
        "max": "File size cannot exceed 10MB"
      }
    },
    "file_category": {
      "type": "string",
      "required": false,
      "maxLength": 50,
      "defaultValue": "attachment",
      "errorMessages": {
        "maxLength": "Category cannot exceed 50 characters"
      },
      "examples": {
        "valid": ["attachment", "photo", "document", "receipt", "contract", "signature"],
        "invalid": [""]
      },
      "allowedValues": [
        "attachment",
        "photo",
        "document",
        "receipt",
        "contract",
        "signature"
      ]
    },
    "is_active": {
      "type": "boolean",
      "required": false,
      "defaultValue": true,
      "errorMessages": {
        "type": "Active status must be true or false"
      }
    },
    "uploaded_by": {
      "type": "integer",
      "required": false,
      "min": 1,
      "max": 2147483647,
      "errorMessages": {
        "type": "Uploaded by must be a number",
        "min": "Uploaded by must be positive",
        "max": "Uploaded by exceeds maximum value"
      }
    }
  },
  "compositeValidations": {
    "createUser": {
      "entityName": "user",
      "requiredFields": [
        "email",
        "first_name",
        "last_name"
      ],
      "optionalFields": [
        "role_id",
        "customer_profile_id",
        "technician_profile_id"
      ],
      "description": "Validation rules for creating a new user"
    },
    "updateUser": {
      "entityName": "user",
      "requiredFields": [],
      "optionalFields": [
        "email",
        "first_name",
        "last_name",
        "role_id",
        "is_active",
        "customer_profile_id",
        "technician_profile_id"
      ],
      "description": "Validation rules for updating an existing user (all fields optional)"
    },
    "createRole": {
      "entityName": "role",
      "requiredFields": [
        "name"
      ],
      "optionalFields": [
        "priority",
        "description",
        "status"
      ],
      "description": "Validation rules for creating a new role"
    },
    "updateRole": {
      "entityName": "role",
      "requiredFields": [],
      "optionalFields": [
        "name",
        "priority",
        "description",
        "status",
        "is_active"
      ],
      "description": "Validation rules for updating an existing role"
    },
    "createCustomer": {
      "entityName": "customer",
      "requiredFields": [
        "first_name",
        "last_name",
        "email"
      ],
      "optionalFields": [
        "phone",
        "organization_name"
      ],
      "description": "Validation rules for creating a customer profile"
    },
    "updateCustomer": {
      "entityName": "customer",
      "requiredFields": [],
      "optionalFields": [
        "first_name",
        "last_name",
        "email",
        "phone",
        "organization_name",
        "is_active",
        "status"
      ],
      "description": "Validation rules for updating a customer profile"
    },
    "createTechnician": {
      "entityName": "technician",
      "requiredFields": [
        "first_name",
        "last_name",
        "email"
      ],
      "optionalFields": [
        "license_number",
        "hourly_rate",
        "status"
      ],
      "description": "Validation rules for creating a technician profile"
    },
    "updateTechnician": {
      "entityName": "technician",
      "requiredFields": [],
      "optionalFields": [
        "first_name",
        "last_name",
        "email",
        "license_number",
        "hourly_rate",
        "is_active",
        "status"
      ],
      "description": "Validation rules for updating a technician profile"
    },
    "createWorkOrder": {
      "entityName": "work_order",
      "requiredFields": [
        "customer_id"
      ],
      "optionalFields": [
        "name",
        "summary",
        "assigned_technician_id",
        "priority",
        "status"
      ],
      "description": "Validation rules for creating a work order"
    },
    "updateWorkOrder": {
      "entityName": "work_order",
      "requiredFields": [],
      "optionalFields": [
        "name",
        "summary",
        "assigned_technician_id",
        "priority",
        "status",
        "is_active"
      ],
      "description": "Validation rules for updating a work order"
    },
    "createInvoice": {
      "entityName": "invoice",
      "requiredFields": [
        "customer_id",
        "amount",
        "total"
      ],
      "optionalFields": [
        "work_order_id",
        "name",
        "summary",
        "tax",
        "status"
      ],
      "description": "Validation rules for creating an invoice"
    },
    "updateInvoice": {
      "entityName": "invoice",
      "requiredFields": [],
      "optionalFields": [
        "name",
        "summary",
        "amount",
        "tax",
        "total",
        "status",
        "is_active"
      ],
      "description": "Validation rules for updating an invoice"
    },
    "createContract": {
      "entityName": "contract",
      "requiredFields": [
        "customer_id",
        "start_date"
      ],
      "optionalFields": [
        "name",
        "summary",
        "end_date",
        "value",
        "status"
      ],
      "description": "Validation rules for creating a contract"
    },
    "updateContract": {
      "entityName": "contract",
      "requiredFields": [],
      "optionalFields": [
        "name",
        "summary",
        "start_date",
        "end_date",
        "value",
        "status",
        "is_active"
      ],
      "description": "Validation rules for updating a contract"
    },
    "createInventory": {
      "entityName": "inventory",
      "requiredFields": [
        "name",
        "sku"
      ],
      "optionalFields": [
        "description",
        "quantity",
        "status"
      ],
      "description": "Validation rules for creating an inventory item"
    },
    "updateInventory": {
      "entityName": "inventory",
      "requiredFields": [],
      "optionalFields": [
        "name",
        "sku",
        "description",
        "quantity",
        "status",
        "is_active"
      ],
      "description": "Validation rules for updating an inventory item"
    }
  },
  "metadata": {
    "maintainer": "TrossApp Team",
    "documentation": "docs/VALIDATION_ARCHITECTURE.md",
    "changelog": [
      {
        "version": "2.2.0",
        "date": "2025-12-30",
        "changes": [
          "Added entityName to all compositeValidations",
          "Enables metadata-driven validation without string parsing",
          "Status field validation now uses entity metadata enum values"
        ]
      },
      {
        "version": "2.1.1",
        "date": "2025-12-30",
        "changes": [
          "BREAKING: Converted all field keys to snake_case",
          "Removed duplicate camelCase field definitions",
          "Eliminated need for field name mapping in validation-loader.js",
          "Single naming convention across entire stack"
        ]
      },
      {
        "version": "2.1.0",
        "date": "2025-01-14",
        "changes": [
          "Renamed 'title' field validator to 'name' for COMPUTED entity consistency",
          "Added 'summary' field validator (VARCHAR 255) for brief descriptions",
          "Updated composite validations: work orders, invoices, contracts now use 'name' and 'summary'",
          "Fixed COMPUTED entity requiredFields: removed auto-generated identifiers (work_order_number, invoice_number, contract_number)",
          "Synced frontend and backend validation-rules.json for full parity"
        ]
      },
      {
        "version": "2.0.0",
        "date": "2025-11-13",
        "changes": [
          "Added validation rules for work order system",
          "Added fields: companyName, licenseNumber, hourlyRate, sku, quantity, amount, invoiceNumber, contractNumber, name, summary, description, customerId, technicianId, workOrderId, status, priority",
          "REMOVED password field - Auth0 handles all authentication",
          "REMOVED signup validation - customers sign up via Auth0 UI",
          "Added composite validations for: customers, technicians, work_orders, invoices, contracts, inventory"
        ]
      },
      {
        "version": "1.0.0",
        "date": "2025-11-10",
        "changes": [
          "Initial centralized validation schema",
          "Permissive email TLD validation policy",
          "Complete field definitions for users and roles"
        ]
      }
    ]
  }
}
